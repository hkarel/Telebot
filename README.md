# Telebot

Telebot - это программная реализация Телеграм-бота для борьбы со спамом в групповых чатах. Telebot был создан как дополнение к ботам проекта  [TgDev](https://tgdev.io/ru/).  
Бот может удалять сообщения соответствующие следующим критериям (триггерам):
- link_disable - Запрещает в сообщении http(s)-ссылки и ТГ-ссылки, за исключением ссылок из белого списка (white_list);
- link_enable - Разрешает в сообщении http(s)-ссылки и ТГ-ссылки, за исключением ссылок из черного списка (black_list). Так же у этого типа триггера есть белый список (white_list), он имеет приоритет над black_list. Белый список используются для разрешения публиковать под/над доменные ссылки из черного списка;
- link - Аналог link_disable;
- word - Срабатывает на слова из списка слов;
- regexp - Срабатывает при соответствии сообщения регулярному выражению;
- timelimit  - Запрещает публиковать сообщения по времени;
- blackuser - Содержит список идентификаторов запрещенных пользователей;
- emptytext  - Запрещает публиковать сообщения без текста.

Telebot - реализован как Linux-сервис. У бота отсутствует механизм конфигурирования посредством телеграм-команд, все управление осуществляется через файлы конфигурации. Основной файл конфигурации бота [/etc/telebot/telebot.conf](https://github.com/hkarel/Telebot/blob/master/config/telebot.conf). Файл [/etc/telebot/telebot.groups](https://github.com/hkarel/Telebot/blob/master/config/telebot.groups) отвечает за конфигурирование триггеров и групп.  Файлы конфигурации записаны в yaml-нотации.

В репозитории проекта есть подготовленные для установки DEB-пакеты. На данный момент доступна установка на ОС Linux Ubuntu 20.04 LTS (см. раздел [Releases](https://github.com/hkarel/Telebot/releases))

### Подключение Telebot в Телеграм

Подключение Telebot в Телеграм осуществляется через бот-аккаунт, который создается при помощи специального телеграм-бота [@BotFather](https://t.me/BotFather). После создания бота в диалоге с [@BotFather](https://t.me/BotFather) нужно ввести команду `/setprivacy`, затем выбрать нового бота и установить для него значение `DISABLE`. Если этого не сделать бот не сможет видеть сообщения других пользователей.  

Чтобы связать Telebot с бот-аккаунтом потребуется выполнить следующие шаги:

1. В файле конфигурации [telebot.conf](https://github.com/hkarel/Telebot/blob/master/config/telebot.conf)  в секции `bot` параметру `id` присвоить идентификатор бот-аккаунта.
2. Создать приватный ключ и сертификат для безопасного обмена данными с сервисом Телеграм. Процесс создания ключа и сертификата описан в [telebot.conf](https://github.com/hkarel/Telebot/blob/master/config/telebot.conf) в секции `webhook`.

### Сборка проекта Telebot

Система сборки ориентирована на Linux системы с пакетным менеджеров DPKG.

1. Установить систему сборки QBS:  
	sudo add-apt-repository ppa:mardy/qbs-on-lts  
	sudo apt-get update  
	sudo apt-get install qbs
2. Запустить сборочный скрипт:  
	./qbs-build

Запуск `./qbs-build` с ключом `-h` покажет возможные варианты использования сборочного скрипта.  Вначале работы сборочный скрипт проверяет наличие необходимых зависимостей и в случае отсутствия предлагает их установить. При запуске скрипта с ключом `-D` будет создан deb-пакет. Сгенерированный deb-пакет сохраняется в директорию `packages`.
